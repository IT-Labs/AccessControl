æK
@c:\D\PROJECTS\AccessControl\Communication\Sockets\AsyncClient.cs
	namespace 	
Communication
 
. 
Sockets 
{ 
public		 

class		 
AsyncClient		 
{

 
private 
ManualResetEvent  
connectDone! ,
=- .
new/ 2
ManualResetEvent3 C
(C D
falseD I
)I J
;J K
private 
ManualResetEvent  
sendDone! )
=* +
new, /
ManualResetEvent0 @
(@ A
falseA F
)F G
;G H
private 
ManualResetEvent  
receiveDone! ,
=- .
new/ 2
ManualResetEvent3 C
(C D
falseD I
)I J
;J K
private 
byte 
[ 
] 
response 
=  !
new" %
byte& *
[* +
$num+ ,
], -
;- .
public 
async 
Task 
< 
byte 
[ 
]  
>  !
StartClient" -
(- .
string. 4
ip5 7
,7 8
int9 <
port= A
,A B
byteC G
[G H
]H I
msgJ M
)M N
{ 	
	IPAddress 
	ipAddress 
=  !
	IPAddress" +
.+ ,
Parse, 1
(1 2
ip2 4
)4 5
;5 6

IPEndPoint 
remoteEP 
=  !
new" %

IPEndPoint& 0
(0 1
	ipAddress1 :
,: ;
port< @
)@ A
;A B
Socket 
client 
= 
new 
Socket  &
(& '
	ipAddress' 0
.0 1
AddressFamily1 >
,> ?

SocketType@ J
.J K
StreamK Q
,Q R
ProtocolTypeS _
._ `
Tcp` c
)c d
;d e
client 
. 
BeginConnect 
(  
remoteEP  (
,( )
new* -
AsyncCallback. ;
(; <
ConnectCallback< K
)K L
,L M
clientN T
)T U
;U V
if!! 
(!! 
!!! 
connectDone!! 
.!! 
WaitOne!! $
(!!$ %
TimeSpan!!% -
.!!- .
FromSeconds!!. 9
(!!9 :
$num!!: <
)!!< =
)!!= >
)!!> ?
{"" 
Console## 
.## 
ForegroundColor## '
=##( )
ConsoleColor##* 6
.##6 7
Red##7 :
;##: ;
Console$$ 
.$$ 
	WriteLine$$ !
($$! "
$str$$" 8
)$$8 9
;$$9 :
Console%% 
.%% 

ResetColor%% "
(%%" #
)%%# $
;%%$ %
}&& 
Send)) 
()) 
client)) 
,)) 
msg)) 
))) 
;)) 
if** 
(** 
!** 
sendDone** 
.** 
WaitOne** !
(**! "
TimeSpan**" *
.*** +
FromSeconds**+ 6
(**6 7
$num**7 9
)**9 :
)**: ;
)**; <
{++ 
Console,, 
.,, 
ForegroundColor,, '
=,,( )
ConsoleColor,,* 6
.,,6 7
Red,,7 :
;,,: ;
Console-- 
.-- 
	WriteLine-- !
(--! "
$str--" 5
)--5 6
;--6 7
Console.. 
... 

ResetColor.. "
(.." #
)..# $
;..$ %
}// 
Receive22 
(22 
client22 
)22 
;22 
if44 
(44 
!44 
receiveDone44 
.44 
WaitOne44 $
(44$ %
TimeSpan44% -
.44- .
FromSeconds44. 9
(449 :
$num44: <
)44< =
)44= >
)44> ?
{55 
Console66 
.66 
ForegroundColor66 '
=66( )
ConsoleColor66* 6
.666 7
Red667 :
;66: ;
Console77 
.77 
	WriteLine77 !
(77! "
$str77" 7
)777 8
;778 9
Console88 
.88 

ResetColor88 "
(88" #
)88# $
;88$ %
}99 
client<< 
.<< 
Shutdown<< 
(<< 
SocketShutdown<< *
.<<* +
Both<<+ /
)<</ 0
;<<0 1
client== 
.== 
Close== 
(== 
)== 
;== 
await?? 
Task?? 
.?? 
Yield?? 
(?? 
)?? 
;?? 
return@@ 
response@@ 
;@@ 
}AA 	
privateCC 
voidCC 
ConnectCallbackCC $
(CC$ %
IAsyncResultCC% 1
arCC2 4
)CC4 5
{DD 	
SocketFF 
clientFF 
=FF 
(FF 
SocketFF #
)FF# $
arFF$ &
.FF& '

AsyncStateFF' 1
;FF1 2
clientII 
.II 

EndConnectII 
(II 
arII  
)II  !
;II! "
ConsoleKK 
.KK 
	WriteLineKK 
(KK 
$strKK 7
,KK7 8
clientKK9 ?
.KK? @
RemoteEndPointKK@ N
.KKN O
ToStringKKO W
(KKW X
)KKX Y
)KKY Z
;KKZ [
connectDoneNN 
.NN 
SetNN 
(NN 
)NN 
;NN 
}OO 	
privateQQ 
voidQQ 
ReceiveQQ 
(QQ 
SocketQQ #
clientQQ$ *
)QQ* +
{RR 	
StateObjectTT 
stateTT 
=TT 
newTT  #
StateObjectTT$ /
(TT/ 0
)TT0 1
;TT1 2
stateUU 
.UU 

workSocketUU 
=UU 
clientUU %
;UU% &
clientXX 
.XX 
BeginReceiveXX 
(XX  
stateXX  %
.XX% &
bufferXX& ,
,XX, -
$numXX. /
,XX/ 0
StateObjectXX1 <
.XX< =

bufferSizeXX= G
,XXG H
$numXXI J
,XXJ K
newXXL O
AsyncCallbackXXP ]
(XX] ^
ReceiveCallbackXX^ m
)XXm n
,XXn o
stateXXp u
)XXu v
;XXv w
}YY 	
private[[ 
void[[ 
ReceiveCallback[[ $
([[$ %
IAsyncResult[[% 1
ar[[2 4
)[[4 5
{\\ 	
StateObject^^ 
state^^ 
=^^ 
(^^  !
StateObject^^! ,
)^^, -
ar^^- /
.^^/ 0

AsyncState^^0 :
;^^: ;
Socket__ 
client__ 
=__ 
state__ !
.__! "

workSocket__" ,
;__, -
intbb 
	bytesReadbb 
=bb 
clientbb "
.bb" #

EndReceivebb# -
(bb- .
arbb. 0
)bb0 1
;bb1 2
Consoleee 
.ee 
	WriteLineee 
(ee 
$stree 1
,ee1 2
	bytesReadee3 <
)ee< =
;ee= >
Arrayhh 
.hh 
Resizehh 
(hh 
refhh 
responsehh %
,hh% &
	bytesReadhh' 0
)hh0 1
;hh1 2
Arraykk 
.kk 
Copykk 
(kk 
statekk 
.kk 
bufferkk #
,kk# $
$numkk% &
,kk& '
responsekk( 0
,kk0 1
$numkk2 3
,kk3 4
	bytesReadkk5 >
)kk> ?
;kk? @
receiveDonemm 
.mm 
Setmm 
(mm 
)mm 
;mm 
}nn 	
privatepp 
voidpp 
Sendpp 
(pp 
Socketpp  
clientpp! '
,pp' (
bytepp) -
[pp- .
]pp. /
byteDatapp0 8
)pp8 9
{qq 	
clientss 
.ss 
	BeginSendss 
(ss 
byteDatass %
,ss% &
$numss' (
,ss( )
byteDatass* 2
.ss2 3
Lengthss3 9
,ss9 :
$numss; <
,ss< =
newss> A
AsyncCallbackssB O
(ssO P
SendCallbackssP \
)ss\ ]
,ss] ^
clientss_ e
)sse f
;ssf g
}tt 	
privatevv 
voidvv 
SendCallbackvv !
(vv! "
IAsyncResultvv" .
arvv/ 1
)vv1 2
{ww 	
Socketyy 
clientyy 
=yy 
(yy 
Socketyy #
)yy# $
aryy$ &
.yy& '

AsyncStateyy' 1
;yy1 2
int|| 
	bytesSent|| 
=|| 
client|| "
.||" #
EndSend||# *
(||* +
ar||+ -
)||- .
;||. /
Console}} 
.}} 
	WriteLine}} 
(}} 
$str}} 9
,}}9 :
	bytesSent}}; D
)}}D E
;}}E F
sendDone
ÄÄ 
.
ÄÄ 
Set
ÄÄ 
(
ÄÄ 
)
ÄÄ 
;
ÄÄ 
}
ÅÅ 	
}
ÇÇ 
}ÉÉ Œ
Ac:\D\PROJECTS\AccessControl\Communication\Sockets\StateObjects.cs
	namespace 	
Communication
 
. 
Sockets 
{ 
public 

class 
StateObject 
{ 
public 
Socket 

workSocket  
=! "
null# '
;' (
public 
const 
int 

bufferSize #
=$ %
$num& )
;) *
public 
byte 
[ 
] 
buffer 
= 
new "
byte# '
[' (

bufferSize( 2
]2 3
;3 4
} 
} ˝)
?c:\D\PROJECTS\AccessControl\Communication\Sockets\SyncClient.cs
	namespace 	
Communication
 
. 
Sockets 
{ 
public 

class 

SyncClient 
{		 
public

 
void

 
StartClient

 
(

  
string

  &
ip

' )
,

) *
int

+ .
port

/ 3
,

3 4
byte

5 9
[

9 :
]

: ;
msg

< ?
)

? @
{ 	
byte 
[ 
] 
bytes 
= 
new 
byte #
[# $
$num$ &
]& '
;' (
try 
{ 
IPHostEntry 

ipHostInfo &
=' (
Dns) ,
., -
GetHostEntry- 9
(9 :
ip: <
)< =
;= >
	IPAddress 
	ipAddress #
=$ %

ipHostInfo& 0
.0 1
AddressList1 <
[< =
$num= >
]> ?
;? @

IPEndPoint 
remoteEP #
=$ %
new& )

IPEndPoint* 4
(4 5
	ipAddress5 >
,> ?
port@ D
)D E
;E F
Socket 
sender 
= 
new  #
Socket$ *
(* +
	ipAddress+ 4
.4 5
AddressFamily5 B
,B C

SocketTypeD N
.N O
StreamO U
,U V
ProtocolTypeW c
.c d
Tcpd g
)g h
;h i
try 
{ 
sender 
. 
Connect "
(" #
remoteEP# +
)+ ,
;, -
Console 
. 
	WriteLine %
(% &
$str& ?
,? @
senderA G
.G H
RemoteEndPointH V
.V W
ToStringW _
(_ `
)` a
)a b
;b c
int"" 
	bytesSent"" !
=""" #
sender""$ *
.""* +
Send""+ /
(""/ 0
msg""0 3
)""3 4
;""4 5
int%% 
bytesRec%%  
=%%! "
sender%%# )
.%%) *
Receive%%* 1
(%%1 2
bytes%%2 7
)%%7 8
;%%8 9
sender(( 
.(( 
Shutdown(( #
(((# $
SocketShutdown(($ 2
.((2 3
Both((3 7
)((7 8
;((8 9
sender)) 
.)) 
Close))  
())  !
)))! "
;))" #
Console,, 
.,, 
	WriteLine,, %
(,,% &
$str,,& 9
,,,9 :
bytesRec,,; C
),,C D
;,,D E
for-- 
(-- 
int-- 
i-- 
=-- 
$num--  !
;--! "
i--# $
<--% &
bytesRec--' /
;--/ 0
i--1 2
++--2 4
)--4 5
{.. 
Console// 
.//  
	WriteLine//  )
(//) *
$str00 A
,00A B
(11 
i11 
.11 
ToString11 '
(11' (
)11( )
.11) *
Length11* 0
>111 2
$num113 4
)114 5
?116 7
i118 9
.119 :
ToString11: B
(11B C
)11C D
:11E F
$str11G J
+11K L
i11M N
.11N O
ToString11O W
(11W X
)11X Y
,11Y Z
bytes22 !
[22! "
i22" #
]22# $
.22$ %
ToString22% -
(22- .
$str22. 2
)222 3
,223 4
Convert33 #
.33# $
ToInt3233$ +
(33+ ,
bytes33, 1
[331 2
i332 3
]333 4
)334 5
)44 
;44 
}55 
}66 
catch77 
(77 !
ArgumentNullException77 ,
ane77- 0
)770 1
{88 
Console99 
.99 
	WriteLine99 %
(99% &
$str99& C
,99C D
ane99E H
.99H I
ToString99I Q
(99Q R
)99R S
)99S T
;99T U
}:: 
catch;; 
(;; 
SocketException;; &
se;;' )
);;) *
{<< 
Console== 
.== 
	WriteLine== %
(==% &
$str==& =
,=== >
se==? A
.==A B
ToString==B J
(==J K
)==K L
)==L M
;==M N
}>> 
catch?? 
(?? 
	Exception??  
e??! "
)??" #
{@@ 
ConsoleAA 
.AA 
	WriteLineAA %
(AA% &
$strAA& B
,AAB C
eAAD E
.AAE F
ToStringAAF N
(AAN O
)AAO P
)AAP Q
;AAQ R
}BB 
}CC 
catchDD 
(DD 
	ExceptionDD 
eDD 
)DD 
{EE 
ConsoleFF 
.FF 
	WriteLineFF !
(FF! "
eFF" #
.FF# $
ToStringFF$ ,
(FF, -
)FF- .
)FF. /
;FF/ 0
}GG 
}HH 	
}II 
}JJ 