´*
4c:\D\PROJECTS\AccessControl\SoyalControllers\Base.cs
	namespace 	
SoyalControllers
 
{ 
public 

abstract 
class 
Base 
{ 
internal		 
readonly		 
byte		 
_destID		 &
;		& '
internal

 
readonly

 
string

  
_ip

! $
;

$ %
internal 
readonly 
int 
_port #
;# $
internal 
Base 
( 
IControllerAddress )
controllerAddress* ;
); <
{ 	
_ip 
= 
controllerAddress #
.# $
	IpAddress$ -
;- .
_port 
= 
controllerAddress %
.% &
Port& *
;* +
_destID 
= 
Convert 
. 
ToByte $
($ %
controllerAddress% 6
.6 7
NodeId7 =
)= >
;> ?
} 	
internal 
byte 
[ 
] 
CalculateXORandSUM *
(* +
byte+ /
[/ 0
]0 1
input2 7
)7 8
{ 	
byte 
zero 
= 
Byte 
. 
Parse "
(" #
$str# '
,' (
NumberStyles) 5
.5 6
	HexNumber6 ?
)? @
;@ A
byte   
xor   
=   
(   
byte   
)   
(   
zero   "
^  # $
input  % *
[  * +
$num  + ,
]  , -
)  - .
;  . /
byte!! 
sum!! 
=!! 
input!! 
[!! 
$num!! 
]!! 
;!!  
for$$ 
($$ 
int$$ 
i$$ 
=$$ 
$num$$ 
;$$ 
i$$ 
<$$ 
input$$ $
.$$$ %
Length$$% +
-$$, -
$num$$. /
;$$/ 0
i$$1 2
++$$2 4
)$$4 5
{%% 
xor&& 
^=&& 
input&& 
[&& 
i&& 
]&& 
;&&  
sum'' 
+='' 
input'' 
['' 
i'' 
]'' 
;''  
}(( 
sum** 
+=** 
xor** 
;** 
return,, 
new,, 
byte,, 
[,, 
],, 
{,, 
xor,, !
,,,! "
sum,,# &
},,& '
;,,' (
}-- 	
internal55 
bool55 
IsValidResponse55 %
(55% &
byte55& *
[55* +
]55+ ,
response55- 5
)555 6
{66 	
byte;; 
[;; 
];; 
calculatedXORandSUM;; &
=;;' (
CalculateXORandSUM;;) ;
(;;; <
response;;< D
);;D E
;;;E F
return>> 
(>> 
response?? 
[?? 
response?? !
.??! "
Length??" (
-??) *
$num??+ ,
]??, -
==??. 0
calculatedXORandSUM??1 D
[??D E
$num??E F
]??F G
&&??H J
response@@ 
[@@ 
response@@ !
.@@! "
Length@@" (
-@@) *
$num@@+ ,
]@@, -
==@@. 0
calculatedXORandSUM@@1 D
[@@D E
$num@@E F
]@@F G
)AA 
;AA 
}BB 	
internalKK 
stringKK 
ConvertToStringKK '
(KK' (
byteKK( ,
[KK, -
]KK- .
bytesKK/ 4
)KK4 5
{LL 	
StringBuilderMM 
sbMM 
=MM 
newMM "
StringBuilderMM# 0
(MM0 1
)MM1 2
;MM2 3
forNN 
(NN 
intNN 
iNN 
=NN 
$numNN 
;NN 
iNN 
<NN 
bytesNN  %
.NN% &
LengthNN& ,
;NN, -
iNN. /
++NN/ 1
)NN1 2
{OO 
sbPP 
.PP 

AppendLinePP 
(PP 
stringPP $
.PP$ %
FormatPP% +
(PP+ ,
$strQQ 9
,QQ9 :
(RR 
iRR 
.RR 
ToStringRR 
(RR  
)RR  !
.RR! "
LengthRR" (
>RR) *
$numRR+ ,
)RR, -
?RR. /
iRR0 1
.RR1 2
ToStringRR2 :
(RR: ;
)RR; <
:RR= >
$strRR? B
+RRC D
iRRE F
.RRF G
ToStringRRG O
(RRO P
)RRP Q
,RRQ R
bytesSS 
[SS 
iSS 
]SS 
.SS 
ToStringSS %
(SS% &
$strSS& *
)SS* +
,SS+ ,
ConvertTT 
.TT 
ToInt32TT #
(TT# $
bytesTT$ )
[TT) *
iTT* +
]TT+ ,
)TT, -
)UU 
)UU 
;UU 
}VV 
returnXX 
sbXX 
.XX 
ToStringXX 
(XX 
)XX  
;XX  !
}YY 	
}ZZ 
}[[ ˚
Ac:\D\PROJECTS\AccessControl\SoyalControllers\ControllerAddress.cs
	namespace 	
SoyalControllers
 
{ 
public 

	interface 
IControllerAddress '
{ 
string 
	IpAddress 
{ 
get 
; 
} 
int 
Port 
{ 
get 
; 
} 
int 
NodeId 
{ 
get 
; 
} 
} 
public

 

class

 
ControllerAddress

 "
:

# $
IControllerAddress

% 7
{ 
public 
string 
	IpAddress 
=>  "
$str# 1
;1 2
public 
int 
Port 
=> 
$num 
;  
public 
int 
NodeId 
=> 
$num 
; 
} 
} ö
?c:\D\PROJECTS\AccessControl\SoyalControllers\GetDeviceStatus.cs
	namespace 	
SoyalControllers
 
{ 
public 

	interface 
IGetDeviceStatus %
{		 
Task

 
<

 
byte

 
[

 
]

 
>

 
Execute

 
(

 
)

 
;

 
} 
public 

class 
GetDeviceStatus  
:! "
Base# '
,' (
IGetDeviceStatus) 9
{ 
private 
readonly 
byte 
_head #
=$ %
Byte& *
.* +
Parse+ 0
(0 1
$str1 5
,5 6
NumberStyles7 C
.C D
	HexNumberD M
)M N
;N O
private 
readonly 
byte 
_cmd "
=# $
Byte% )
.) *
Parse* /
(/ 0
$str0 4
,4 5
NumberStyles6 B
.B C
	HexNumberC L
)L M
;M N
public 
GetDeviceStatus 
( 
IControllerAddress 1
controllerAddress2 C
)C D
:E F
baseG K
(L M
controllerAddressM ^
)^ _
{ 	
} 	
public 
async 
Task 
< 
byte 
[ 
]  
>  !
Execute" )
() *
)* +
{ 	
byte 
[ 
] 
msg 
= 
new 
byte !
[! "
$num" #
]# $
;$ %
msg 
[ 
$num 
] 
= 
_head 
; 
msg   
[   
$num   
]   
=   
Convert   
.   
ToByte   #
(  # $
msg  $ '
.  ' (
Length  ( .
-  / 0
$num  1 2
)  2 3
;  3 4
msg!! 
[!! 
$num!! 
]!! 
=!! 
base!! 
.!! 
_destID!! !
;!!! "
msg"" 
["" 
$num"" 
]"" 
="" 
_cmd"" 
;"" 
byte$$ 
[$$ 
]$$ 
	XORandSUM$$ 
=$$ 
base$$ #
.$$# $
CalculateXORandSUM$$$ 6
($$6 7
msg$$7 :
)$$: ;
;$$; <
msg&& 
[&& 
msg&& 
.&& 
Length&& 
-&& 
$num&& 
]&& 
=&&  !
	XORandSUM&&" +
[&&+ ,
$num&&, -
]&&- .
;&&. /
msg'' 
['' 
msg'' 
.'' 
Length'' 
-'' 
$num'' 
]'' 
=''  !
	XORandSUM''" +
[''+ ,
$num'', -
]''- .
;''. /
byte)) 
[)) 
])) 
response)) 
=)) 
await)) #
new))$ '
AsyncClient))( 3
())3 4
)))4 5
.))5 6
StartClient))6 A
())A B
base))B F
.))F G
_ip))G J
,))J K
base))L P
.))P Q
_port))Q V
,))V W
msg))X [
)))[ \
.))\ ]
ConfigureAwait))] k
())k l
false))l q
)))q r
;))r s
if++ 
(++ 
!++ 
IsValidResponse++ 
(++  
response++  (
)++( )
)++) *
{,, 
throw-- 
new-- 
	Exception-- #
(--# $
$str--$ K
)--K L
;--L M
}.. 
return11 
response11 
;11 
}22 	
}33 
}44 È4
@c:\D\PROJECTS\AccessControl\SoyalControllers\GetRealTimeClock.cs
	namespace 	
SoyalControllers
 
{ 
public 

	interface 
IGetRealTimeClock &
{		 
Task

 
<

 
DateTime

 
>

 
Execute

 
(

 
)

  
;

  !
} 
public 

class 
GetRealTimeClock !
:" #
Base$ (
,( )
IGetRealTimeClock* ;
{ 
private 
readonly 
byte 
_head #
=$ %
Byte& *
.* +
Parse+ 0
(0 1
$str1 5
,5 6
NumberStyles7 C
.C D
	HexNumberD M
)M N
;N O
private 
readonly 
byte 
_cmd "
=# $
Byte% )
.) *
Parse* /
(/ 0
$str0 4
,4 5
NumberStyles6 B
.B C
	HexNumberC L
)L M
;M N
public 
GetRealTimeClock 
(  
IControllerAddress  2
controllerAddress3 D
)D E
:F G
baseH L
(M N
controllerAddressN _
)_ `
{ 	
} 	
public 
async 
Task 
< 
DateTime "
>" #
Execute$ +
(+ ,
), -
{ 	
byte 
[ 
] 
msg 
= 
new 
byte !
[! "
$num" #
]# $
;$ %
msg 
[ 
$num 
] 
= 
_head 
; 
msg 
[ 
$num 
] 
= 
Convert 
. 
ToByte #
(# $
msg$ '
.' (
Length( .
-/ 0
$num1 2
)2 3
;3 4
msg   
[   
$num   
]   
=   
base   
.   
_destID   !
;  ! "
msg!! 
[!! 
$num!! 
]!! 
=!! 
_cmd!! 
;!! 
byte## 
[## 
]## 
	XORandSUM## 
=## 
base## #
.### $
CalculateXORandSUM##$ 6
(##6 7
msg##7 :
)##: ;
;##; <
msg%% 
[%% 
msg%% 
.%% 
Length%% 
-%% 
$num%% 
]%% 
=%%  !
	XORandSUM%%" +
[%%+ ,
$num%%, -
]%%- .
;%%. /
msg&& 
[&& 
msg&& 
.&& 
Length&& 
-&& 
$num&& 
]&& 
=&&  !
	XORandSUM&&" +
[&&+ ,
$num&&, -
]&&- .
;&&. /
byte(( 
[(( 
](( 
response(( 
=(( 
await(( #
new(($ '
AsyncClient((( 3
(((3 4
)((4 5
.((5 6
StartClient((6 A
(((A B
base((B F
.((F G
_ip((G J
,((J K
base((L P
.((P Q
_port((Q V
,((V W
msg((X [
)(([ \
.((\ ]
ConfigureAwait((] k
(((k l
false((l q
)((q r
;((r s
if** 
(** 
!** 
IsValidResponse** 
(**  
response**  (
)**( )
)**) *
{++ 
throw,, 
new,, 
	Exception,, #
(,,# $
$str,,$ K
),,K L
;,,L M
}-- 
System// 
.// 
Text// 
.// 
StringBuilder// %
sb//& (
=//) *
new//+ .
System/// 5
.//5 6
Text//6 :
.//: ;
StringBuilder//; H
(//H I
)//I J
;//J K
for11 
(11 
int11 
i11 
=11 
$num11 
;11 
i11 
<11 
response11 '
.11' (
Length11( .
;11. /
i110 1
++111 3
)113 4
{22 
sb33 
.33 

AppendLine33 
(33 
string33 $
.33$ %
Format33% +
(33+ ,
$str44 9
,449 :
(55 
i55 
.55 
ToString55 
(55  
)55  !
.55! "
Length55" (
>55) *
$num55+ ,
)55, -
?55. /
i550 1
.551 2
ToString552 :
(55: ;
)55; <
:55= >
$str55? B
+55C D
i55E F
.55F G
ToString55G O
(55O P
)55P Q
,55Q R
response66 
[66 
i66 
]66 
.66  
ToString66  (
(66( )
$str66) -
)66- .
,66. /
Convert77 
.77 
ToInt3277 #
(77# $
response77$ ,
[77, -
i77- .
]77. /
)77/ 0
)88 
)88 
;88 
}99 
Console;; 
.;; 
Write;; 
(;; 
sb;; 
.;; 
ToString;; %
(;;% &
);;& '
);;' (
;;;( )
return>> 
new>> 
DateTime>> 
(>>  
Convert?? 
.?? 
ToInt32?? 
(??  
response??  (
[??( )
$num??) +
]??+ ,
+??- .
$num??/ 3
)??3 4
,??4 5
ConvertAA 
.AA 
ToInt32AA 
(AA  
responseAA  (
[AA( )
$numAA) +
]AA+ ,
)AA, -
,AA- .
ConvertBB 
.BB 
ToInt32BB 
(BB  
responseBB  (
[BB( )
$numBB) *
]BB* +
)BB+ ,
,BB, -
ConvertCC 
.CC 
ToInt32CC 
(CC  
responseCC  (
[CC( )
$numCC) *
]CC* +
)CC+ ,
,CC, -
ConvertDD 
.DD 
ToInt32DD 
(DD  
responseDD  (
[DD( )
$numDD) *
]DD* +
)DD+ ,
,DD, -
ConvertEE 
.EE 
ToInt32EE 
(EE  
responseEE  (
[EE( )
$numEE) *
]EE* +
)EE+ ,
)FF 
;FF 
}GG 	
}HH 
}II êC
;c:\D\PROJECTS\AccessControl\SoyalControllers\GetUserData.cs
	namespace 	
SoyalControllers
 
{ 
public		 

	interface		 
IGetUserData		 !
{

 
Task 
< 
string 
> 
Execute 
( 
int  
[  !
,! "
]" #
cards$ )
)) *
;* +
} 
public 

class 
GetUserData 
: 
Base #
,# $
IGetUserData% 1
{ 
private 
readonly 
byte 
_head #
=$ %
Byte& *
.* +
Parse+ 0
(0 1
$str1 5
,5 6
NumberStyles7 C
.C D
	HexNumberD M
)M N
;N O
private 
readonly 
byte 
_cmd "
=# $
Byte% )
.) *
Parse* /
(/ 0
$str0 4
,4 5
NumberStyles6 B
.B C
	HexNumberC L
)L M
;M N
public 
GetUserData 
( 
IControllerAddress -
controllerAddress. ?
)? @
:A B
baseC G
(H I
controllerAddressI Z
)Z [
{ 	
} 	
public 
async 
Task 
< 
string  
>  !
Execute" )
() *
int* -
[- .
,. /
]/ 0
cards1 6
)6 7
{ 	
byte 
[ 
] 
msg 
= 
new 
byte !
[! "
$num" #
+$ %
cards& +
.+ ,
Length, 2
*3 4
$num5 6
]6 7
;7 8
msg   
[   
$num   
]   
=   
_head   
;   
msg!! 
[!! 
$num!! 
]!! 
=!! 
Convert!! 
.!! 
ToByte!! #
(!!# $
msg!!$ '
.!!' (
Length!!( .
-!!/ 0
$num!!1 2
)!!2 3
;!!3 4
msg"" 
["" 
$num"" 
]"" 
="" 
base"" 
."" 
_destID"" !
;""! "
msg## 
[## 
$num## 
]## 
=## 
_cmd## 
;## 
for%% 
(%% 
int%% 
i%% 
=%% 
$num%% 
;%% 
i%% 
<%% 
cards%% $
.%%$ %
Length%%% +
/%%, -
$num%%. /
;%%/ 0
i%%1 2
++%%2 4
)%%4 5
{&& 
byte'' 
['' 
]'' 
cardBytesLow'' #
=''$ %
BitConverter''& 2
.''2 3
GetBytes''3 ;
(''; <
cards''< A
[''A B
i''B C
,''C D
$num''D E
]''E F
)''F G
;''G H
byte(( 
[(( 
](( 
cardBytesHigh(( $
=((% &
BitConverter((' 3
.((3 4
GetBytes((4 <
(((< =
cards((= B
[((B C
i((C D
,((D E
$num((E F
]((F G
)((G H
;((H I
Array** 
.** 
Resize** 
(** 
ref**  
cardBytesLow**! -
,**- .
$num**/ 0
)**0 1
;**1 2
Array++ 
.++ 
Resize++ 
(++ 
ref++  
cardBytesHigh++! .
,++. /
$num++0 1
)++1 2
;++2 3
if-- 
(-- 
BitConverter--  
.--  !
IsLittleEndian--! /
)--/ 0
{.. 
Array// 
.// 
Reverse// !
(//! "
cardBytesLow//" .
)//. /
;/// 0
Array00 
.00 
Reverse00 !
(00! "
cardBytesHigh00" /
)00/ 0
;000 1
}11 
int33 
index33 
=33 
(33 
i33 
*33  
$num33! "
)33" #
+33$ %
$num33& '
;33' (
msg55 
[55 
index55 
]55 
=55 
cardBytesLow55 )
[55) *
$num55* +
]55+ ,
;55, -
msg66 
[66 
index66 
+66 
$num66 
]66 
=66  
cardBytesLow66! -
[66- .
$num66. /
]66/ 0
;660 1
msg88 
[88 
index88 
+88 
$num88 
]88 
=88  
cardBytesHigh88! .
[88. /
$num88/ 0
]880 1
;881 2
msg99 
[99 
index99 
+99 
$num99 
]99 
=99  
cardBytesHigh99! .
[99. /
$num99/ 0
]990 1
;991 2
}:: 
msg<< 
[<< 
msg<< 
.<< 
Length<< 
-<< 
$num<< 
]<< 
=<<  !
Convert<<" )
.<<) *
ToByte<<* 0
(<<0 1
cards<<1 6
.<<6 7
Length<<7 =
/<<> ?
$num<<@ A
)<<A B
;<<B C
byte>> 
[>> 
]>> 
	XORandSUM>> 
=>> 
base>> #
.>># $
CalculateXORandSUM>>$ 6
(>>6 7
msg>>7 :
)>>: ;
;>>; <
msg@@ 
[@@ 
msg@@ 
.@@ 
Length@@ 
-@@ 
$num@@ 
]@@ 
=@@  !
	XORandSUM@@" +
[@@+ ,
$num@@, -
]@@- .
;@@. /
msgAA 
[AA 
msgAA 
.AA 
LengthAA 
-AA 
$numAA 
]AA 
=AA  !
	XORandSUMAA" +
[AA+ ,
$numAA, -
]AA- .
;AA. /
byteCC 
[CC 
]CC 
responseCC 
=CC 
awaitCC #
newCC$ '
AsyncClientCC( 3
(CC3 4
)CC4 5
.CC5 6
StartClientCC6 A
(CCA B
baseCCB F
.CCF G
_ipCCG J
,CCJ K
baseCCL P
.CCP Q
_portCCQ V
,CCV W
msgCCX [
)CC[ \
.CC\ ]
ConfigureAwaitCC] k
(CCk l
falseCCl q
)CCq r
;CCr s
ifEE 
(EE 
!EE 
IsValidResponseEE 
(EE  
responseEE  (
)EE( )
)EE) *
{FF 
throwGG 
newGG 
	ExceptionGG #
(GG# $
$strGG$ K
)GGK L
;GGL M
}HH 
StringBuilderKK 
sbKK 
=KK 
newKK "
StringBuilderKK# 0
(KK0 1
)KK1 2
;KK2 3
forLL 
(LL 
intLL 
iLL 
=LL 
$numLL 
;LL 
iLL 
<LL 
responseLL  (
.LL( )
LengthLL) /
;LL/ 0
iLL1 2
++LL2 4
)LL4 5
{MM 
sbNN 
.NN 

AppendLineNN 
(NN 
stringNN $
.NN$ %
FormatNN% +
(NN+ ,
$strOO 9
,OO9 :
(PP 
iPP 
.PP 
ToStringPP 
(PP  
)PP  !
.PP! "
LengthPP" (
>PP) *
$numPP+ ,
)PP, -
?PP. /
iPP0 1
.PP1 2
ToStringPP2 :
(PP: ;
)PP; <
:PP= >
$strPP? B
+PPC D
iPPE F
.PPF G
ToStringPPG O
(PPO P
)PPP Q
,PPQ R
responseQQ 
[QQ 
iQQ 
]QQ 
.QQ  
ToStringQQ  (
(QQ( )
$strQQ) -
)QQ- .
,QQ. /
ConvertRR 
.RR 
ToInt32RR #
(RR# $
responseRR$ ,
[RR, -
iRR- .
]RR. /
)RR/ 0
)SS 
)SS 
;SS 
}TT 
returnVV 
sbVV 
.VV 
ToStringVV 
(VV 
)VV  
;VV  !
}WW 	
}XX 
}YY 